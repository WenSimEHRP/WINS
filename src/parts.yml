---
# temperate registers are automatically sorted and assigned
temps:
  t_underlay: sw_fence_underlay()
  t_fence: sw_fence()

# rail underlay
rail:
  ground:
    x: >
      ground { sprite: GROUNDSPRITE_RAIL_X; }
    y: >
      ground { sprite: GROUNDSPRITE_RAIL_Y; }

# fence grass underlay
underlay:
  north:
    x: >
      childsprite {
        sprite: CUSTOM(0, getbits(LOAD_TEMP(t_underlay), 2, 8) * 4 + id_fence_end * 2 + 2);
        hide_sprite: getbits(LOAD_TEMP(t_underlay), 2, 8) == none_code || getbits(LOAD_TEMP(t_underlay), 0, 1);
      }
    y: >
      childsprite {
        sprite: CUSTOM(0, getbits(LOAD_TEMP(t_underlay), 2, 8) * 4 + id_fence_end * 2 + 3);
        hide_sprite: getbits(LOAD_TEMP(t_underlay), 2, 8) == none_code || getbits(LOAD_TEMP(t_underlay), 0, 1);
      }
  south:
    x: >
      childsprite {
        sprite: CUSTOM(0, getbits(LOAD_TEMP(t_underlay), 2, 8) * 4 + id_fence_end * 2 + 0);
        hide_sprite: getbits(LOAD_TEMP(t_underlay), 2, 8) == none_code || getbits(LOAD_TEMP(t_underlay), 1, 1);
      }
    y: >
      childsprite {
        sprite: CUSTOM(0, getbits(LOAD_TEMP(t_underlay), 2, 8) * 4 + id_fence_end * 2 + 1);
        hide_sprite: getbits(LOAD_TEMP(t_underlay), 2, 8) == none_code || getbits(LOAD_TEMP(t_underlay), 1, 1);
      }

# fence
fence:
  north:
    x: >
      building {
        sprite: CUSTOM(0, LOAD_TEMP(t_fence) * 2);
        xextent: 16;
        yextent: 0;
        zextent: 4;
        hide_sprite: LOAD_TEMP(t_fence) == none_code || getbits(LOAD_TEMP(t_underlay), 1, 1);
      }
    y: >
      building {
        sprite: CUSTOM(0, LOAD_TEMP(t_fence) * 2 + 1);
        xextent: 0;
        yextent: 16;
        zextent: 4;
        hide_sprite: LOAD_TEMP(t_fence) == none_code || getbits(LOAD_TEMP(t_underlay), 1, 1);
      }
  south:
    x: >
      building {
        sprite: CUSTOM(0, LOAD_TEMP(t_fence) * 2);
        xextent: 16;
        yoffset: 16;
        yextent: 0;
        zextent: 4;
        hide_sprite: LOAD_TEMP(t_fence) == none_code || getbits(LOAD_TEMP(t_underlay), 0, 1);
      }
    y: >
      building {
        sprite: CUSTOM(0, LOAD_TEMP(t_fence) * 2 + 1);
        xextent: 0;
        xoffset: 16;
        yextent: 16;
        zextent: 4;
        hide_sprite: LOAD_TEMP(t_fence) == none_code || getbits(LOAD_TEMP(t_underlay), 0, 1);
      }
